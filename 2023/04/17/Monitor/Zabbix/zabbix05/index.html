

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/default.ico">
  <link rel="icon" href="/img/default.ico">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="陈怀森">
  <meta name="keywords" content="">
  
    <meta name="description" content="1.Zabbix监控Tomcat服务#官方tomcat模板地址 https:&#x2F;&#x2F;www.zabbix.com&#x2F;cn&#x2F;integrations&#x2F;tomcat  1.1 安装配置Tomcat#1.安装JDK root@zabbix-agent-active:~# apt install openjdk-8-jdk  #2.安装Tomcat wget https:&#x2F;&#x2F;dlcdn.apache.org&#x2F;t">
<meta property="og:type" content="article">
<meta property="og:title" content="(5).Zabbix监控案例">
<meta property="og:url" content="https://chsblogs.gitee.io/2023/04/17/Monitor/Zabbix/zabbix05/index.html">
<meta property="og:site_name" content="陈怀森の运维笔记">
<meta property="og:description" content="1.Zabbix监控Tomcat服务#官方tomcat模板地址 https:&#x2F;&#x2F;www.zabbix.com&#x2F;cn&#x2F;integrations&#x2F;tomcat  1.1 安装配置Tomcat#1.安装JDK root@zabbix-agent-active:~# apt install openjdk-8-jdk  #2.安装Tomcat wget https:&#x2F;&#x2F;dlcdn.apache.org&#x2F;t">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://chsblogs.gitee.io/2023/04/17/Monitor/Zabbix/zabbix05/image-20230422222136677.png">
<meta property="og:image" content="https://chsblogs.gitee.io/2023/04/17/Monitor/Zabbix/zabbix05/image-20230422222219702.png">
<meta property="og:image" content="https://chsblogs.gitee.io/2023/04/17/Monitor/Zabbix/zabbix05/image-20230423000954298.png">
<meta property="og:image" content="https://chsblogs.gitee.io/2023/04/17/Monitor/Zabbix/zabbix05/image-20230423001016900.png">
<meta property="og:image" content="https://chsblogs.gitee.io/2023/04/17/Monitor/Zabbix/zabbix05/image-20230422230130711.png">
<meta property="og:image" content="https://chsblogs.gitee.io/2023/04/17/Monitor/Zabbix/zabbix05/image-20230422230217173.png">
<meta property="article:published_time" content="2023-04-17T03:31:07.000Z">
<meta property="article:modified_time" content="2023-04-22T16:35:33.089Z">
<meta property="article:author" content="陈怀森">
<meta property="article:tag" content="Zabbix">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://chsblogs.gitee.io/2023/04/17/Monitor/Zabbix/zabbix05/image-20230422222136677.png">
  
  
  
  <title>(5).Zabbix监控案例 - 陈怀森の运维笔记</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"chsblogs.gitee.io","root":"/","version":"1.9.4","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":"§"},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"SHELL"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"left","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":6},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 6.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>陈怀森 の 运维笔记</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/">
                <i class="iconfont icon-link-fill"></i>
                <span>友链</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.jpg') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="(5).Zabbix监控案例"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2023-04-17 11:31" pubdate>
          2023年4月17日 中午
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          5.9k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          5 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="padding-left: 2rem; margin-right: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">(5).Zabbix监控案例</h1>
            
            
              <div class="markdown-body">
                
                <h1 id="1-Zabbix监控Tomcat服务"><a href="#1-Zabbix监控Tomcat服务" class="headerlink" title="1.Zabbix监控Tomcat服务"></a>1.Zabbix监控Tomcat服务</h1><figure><div class="code-wrapper"><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#官方tomcat模板地址</span>
https://www.zabbix.com/cn/integrations/tomcat</code></pre></div></figure>

<h2 id="1-1-安装配置Tomcat"><a href="#1-1-安装配置Tomcat" class="headerlink" title="1.1 安装配置Tomcat"></a>1.1 安装配置Tomcat</h2><figure><div class="code-wrapper"><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#1.安装JDK</span>
root@zabbix-agent-active:~<span class="token comment"># apt install openjdk-8-jdk</span>

<span class="token comment">#2.安装Tomcat</span>
<span class="token function">wget</span> https://dlcdn.apache.org/tomcat/tomcat-9/v9.0.72/bin/apache-tomcat-9.0.72.tar.gz
<span class="token function">tar</span> <span class="token parameter variable">-xvf</span> apache-tomcat-9.0.72.tar.gz <span class="token parameter variable">-C</span> /usr/local/
<span class="token builtin class-name">cd</span> /usr/local/
<span class="token function">ln</span> <span class="token parameter variable">-s</span> apache-tomcat-9.0.72/ tomcat
<span class="token builtin class-name">echo</span> <span class="token string">'PATH=/usr/local/tomcat/bin:$PATH'</span> <span class="token operator">></span> /etc/profile.d/tomcat.sh
<span class="token builtin class-name">.</span> /etc/profile.d/tomcat.sh

<span class="token comment">#3.Tomcat开启JMX监控，JMX在Java编程语言中定义了应用程序以及网络管理和监控的体系结构，设计模式，应用程序接口以及服务，通常使用JMX来监控系统的运行状态。</span>
<span class="token comment">#-Dcom.sun.management.jmxremote \ #启动远程监控JMX</span>
<span class="token comment">#-Dcom.sun.management.jmxremote.port=12345 \ #启用JMX端口号</span>
<span class="token comment">#-Dcom.sun.management.jmxremote.authenticate=false \ #不使用用户名密码</span>
<span class="token comment">#-Dcom.sun.management.jmxremote.ssl=false \ #不适用ssl认证</span>
<span class="token comment">#-Djava.rmi.server.hostname=192.168.1.33" #Tomcat主机IP地址</span>
root@zabbix-agent-active:~<span class="token comment"># vim /usr/local/tomcat/bin/catalina.sh</span>
<span class="token assign-left variable">CATALINA_OPTS</span><span class="token operator">=</span><span class="token string">"<span class="token variable">$CATALINA_OPTS</span> \
-Dcom.sun.management.jmxremote \
-Dcom.sun.management.jmxremote.port=12345 \
-Dcom.sun.management.jmxremote.authenticate=false \
-Dcom.sun.management.jmxremote.ssl=false \
-Djava.rmi.server.hostname=192.168.1.33"</span></code></pre></div></figure>



<h2 id="1-2-安装配置Java-Gateway"><a href="#1-2-安装配置Java-Gateway" class="headerlink" title="1.2 安装配置Java Gateway"></a>1.2 安装配置Java Gateway</h2><figure><div class="code-wrapper"><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#1.安装Java Gateway</span>
root@zabbix-agent-active:~<span class="token comment"># wget https://repo.zabbix.com/zabbix/6.0/ubuntu/pool/main/z/zabbix-release/zabbix-release_6.0-4+ubuntu20.04_all.deb</span>
root@zabbix-agent-active:~<span class="token comment"># dpkg -i zabbix-release_6.0-4+ubuntu20.04_all.deb</span>
root@zabbix-agent-active:~<span class="token comment"># apt update</span>
root@zabbix-agent-active:~<span class="token comment"># apt install zabbix-java-gateway</span>

<span class="token comment">#2.配置Java Gateway</span>
root@zabbix-agent-active:~<span class="token comment"># grep -Ev "^#|^$" /etc/zabbix/zabbix_java_gateway.conf </span>
<span class="token assign-left variable">LISTEN_IP</span><span class="token operator">=</span><span class="token string">"0.0.0.0"</span>
<span class="token assign-left variable">LISTEN_PORT</span><span class="token operator">=</span><span class="token number">10052</span>
<span class="token assign-left variable">PID_FILE</span><span class="token operator">=</span><span class="token string">"/var/run/zabbix/zabbix_java_gateway.pid"</span>
<span class="token assign-left variable">START_POLLERS</span><span class="token operator">=</span><span class="token number">5</span>
<span class="token assign-left variable">TIMEOUT</span><span class="token operator">=</span><span class="token number">30</span>

root@zabbix-agent-active:~<span class="token comment"># systemctl restart zabbix-java-gateway</span>
root@zabbix-agent-active:~<span class="token comment"># systemctl enable zabbix-java-gateway</span></code></pre></div></figure>



<h2 id="1-3-配置Zabbix-Server"><a href="#1-3-配置Zabbix-Server" class="headerlink" title="1.3 配置Zabbix Server"></a>1.3 配置Zabbix Server</h2><figure><div class="code-wrapper"><pre class="language-bash" data-language="bash"><code class="language-bash">root@zabbix-server:~<span class="token comment"># vim /etc/zabbix/zabbix_server.conf</span>
<span class="token assign-left variable">JavaGateway</span><span class="token operator">=</span><span class="token number">192.168</span>.1.33 <span class="token comment">#监听地址</span>
<span class="token assign-left variable">JavaGatewayPort</span><span class="token operator">=</span><span class="token number">10052</span> <span class="token comment">#指定Java Gateway的服务器监听端口</span>
<span class="token assign-left variable">StartJavaPollers</span><span class="token operator">=</span><span class="token number">20</span> <span class="token comment">#启动多少个线程轮询Java Gateway</span>

root@zabbix-server:~<span class="token comment"># systemctl restart zabbix-server</span></code></pre></div></figure>



<h2 id="1-4-Zabbix-Server添加JMX监控"><a href="#1-4-Zabbix-Server添加JMX监控" class="headerlink" title="1.4 Zabbix Server添加JMX监控"></a>1.4 Zabbix Server添加JMX监控</h2><p><img src="/2023/04/17/Monitor/Zabbix/zabbix05/image-20230422222136677.png" srcset="/img/loading.gif" lazyload alt="image-20230422222136677"> </p>
<p><img src="/2023/04/17/Monitor/Zabbix/zabbix05/image-20230422222219702.png" srcset="/img/loading.gif" lazyload alt="image-20230422222219702"> </p>
<h1 id="2-Zabbix监控Linux-TCP连接状态"><a href="#2-Zabbix监控Linux-TCP连接状态" class="headerlink" title="2.Zabbix监控Linux TCP连接状态"></a>2.Zabbix监控Linux TCP连接状态</h1><h1 id="3-Zabbix监控Memcache服务"><a href="#3-Zabbix监控Memcache服务" class="headerlink" title="3.Zabbix监控Memcache服务"></a>3.Zabbix监控Memcache服务</h1><h1 id="4-Zabbix监控Redis服务"><a href="#4-Zabbix监控Redis服务" class="headerlink" title="4.Zabbix监控Redis服务"></a>4.Zabbix监控Redis服务</h1><h1 id="5-Zabbix监控Nginx服务"><a href="#5-Zabbix监控Nginx服务" class="headerlink" title="5.Zabbix监控Nginx服务"></a>5.Zabbix监控Nginx服务</h1><p>对nginx的活动连接和当前状态等运行状态进行监控</p>
<figure><div class="code-wrapper"><pre class="language-bash" data-language="bash"><code class="language-bash">Active connections: <span class="token number">3</span> 
server accepts handled requests
 <span class="token number">3</span> <span class="token number">3</span> <span class="token number">4</span> 
Reading: <span class="token number">0</span> Writing: <span class="token number">1</span> Waiting: <span class="token number">2</span>

Active connections：当前处于活动状态的客户端连接数，包括连接等待空闲连接数。
accepts：统计总值，nginx自启动后已经接受的客户端请求的总数。
handled：统计总值，nginx自启动后已经处理完成的客户端请求总数，通常等于accepts，除非有因为worker_connections限制等被拒绝的连接。
requests：统计总值，nginx自启动后客户端发来的总的请求数。
Reading: 当前状态，正在读取客户端请求报文首部的连接的连接数。
Writing: 当前状态，正在向客户端发送响应报文过程中的连接数。
Waiting: 正在等待客户端发出请求的空闲连接数，开启keep-alive的情况下，这个值等于active - （reading + writing）</code></pre></div></figure>

<h2 id="5-1-zabbix官方模板说明"><a href="#5-1-zabbix官方模板说明" class="headerlink" title="5.1 zabbix官方模板说明"></a>5.1 zabbix官方模板说明</h2><figure><div class="code-wrapper"><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#官方nginx模板说明地址</span>
https://www.zabbix.com/cn/integrations/nginx

<span class="token comment">#1.Overview</span>
For Zabbix version: <span class="token number">6.0</span> and higher
The template to monitor Nginx by Zabbix that work without any external scripts. Most of the metrics are collected <span class="token keyword">in</span> one go, thanks to Zabbix bulk data collection.

Template Nginx by Zabbix agent collects metrics by polling ngx_http_stub_status_module locally with Zabbix agent:
    Active connections: <span class="token number">291</span>
    server accepts handled requests
    <span class="token number">16630948</span> <span class="token number">16630948</span> <span class="token number">31070465</span>
    Reading: <span class="token number">6</span> Writing: <span class="token number">179</span> Waiting: <span class="token number">106</span>
Note that this template doesn<span class="token string">'t support https and redirects (limitations of web.page.get).

It also uses Zabbix agent to collect nginx Linux process stats like CPU usage, memory usage and whether process is running or not.

This template was tested on:

Nginx, version 1.17.2

#2.Setup
See Zabbix template operation for basic instructions.

Setup ngx_http_stub_status_module. Test availability of http_stub_status module with nginx -V 2>&amp;1 | grep -o with-http_stub_status_module.

Example configuration of Nginx:
    location = /basic_status &#123;
        stub_status;
        allow 127.0.0.1;
        allow ::1;
        deny all;
    &#125;
    
If you use another location, then don'</span>t forget to change <span class="token punctuation">&#123;</span><span class="token variable">$NGINX</span>.STUB_STATUS.<span class="token environment constant">PATH</span><span class="token punctuation">&#125;</span> macro. Install and setup Zabbix agent.</code></pre></div></figure>



<h2 id="5-2-配置监控nginx"><a href="#5-2-配置监控nginx" class="headerlink" title="5.2 配置监控nginx"></a>5.2 配置监控nginx</h2><figure><div class="code-wrapper"><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#1.安装nginx，在主机[192.168.1.31]上安装nginx测试</span>
root@mysql-master:~<span class="token comment"># apt install nginx</span>

<span class="token comment">#2.配置nginx</span>
root@mysql-master:~<span class="token comment"># vim /etc/nginx/sites-enabled/default</span>
<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>
server <span class="token punctuation">&#123;</span>
        listen <span class="token number">80</span> default_server<span class="token punctuation">;</span>
        listen <span class="token punctuation">[</span>::<span class="token punctuation">]</span>:80 default_server<span class="token punctuation">;</span>
        
        <span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>
        
        location <span class="token operator">=</span> /basic_status <span class="token punctuation">&#123;</span>
          stub_status<span class="token punctuation">;</span>
          allow <span class="token number">127.0</span>.0.1<span class="token punctuation">;</span>
          allow ::1<span class="token punctuation">;</span>
          deny all<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        
        <span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">#3.Zabbix Server添加nginx模板：</span></code></pre></div></figure>



<p><img src="/2023/04/17/Monitor/Zabbix/zabbix05/image-20230423000954298.png" srcset="/img/loading.gif" lazyload alt="image-20230423000954298"> </p>
<p><img src="/2023/04/17/Monitor/Zabbix/zabbix05/image-20230423001016900.png" srcset="/img/loading.gif" lazyload alt="image-20230423001016900"> </p>
<h1 id="6-Zabbix基于SNMP监控"><a href="#6-Zabbix基于SNMP监控" class="headerlink" title="6.Zabbix基于SNMP监控"></a>6.Zabbix基于SNMP监控</h1><h2 id="6-1-SNMP简介"><a href="#6-1-SNMP简介" class="headerlink" title="6.1 SNMP简介"></a>6.1 SNMP简介</h2><h2 id="6-2-基于SNMP监控打印机"><a href="#6-2-基于SNMP监控打印机" class="headerlink" title="6.2 基于SNMP监控打印机"></a>6.2 基于SNMP监控打印机</h2><p>基于SNMP监控打印机耗材状况，当打印机耗材余量不足5%时，触发告警。</p>
<table>
<thead>
<tr>
<th>耗材情况</th>
<th>OID</th>
</tr>
</thead>
<tbody><tr>
<td>碳粉（品红）</td>
<td>.1.3.6.1.2.1.43.11.1.1.9.1.2</td>
</tr>
<tr>
<td>碳粉（青）</td>
<td>.1.3.6.1.2.1.43.11.1.1.9.1.1</td>
</tr>
<tr>
<td>碳粉（黄）</td>
<td>.1.3.6.1.2.1.43.11.1.1.9.1.3</td>
</tr>
<tr>
<td>碳粉（黑）</td>
<td>.1.3.6.1.2.1.43.11.1.1.9.1.4</td>
</tr>
</tbody></table>
<h3 id="6-2-1-打印机耗材监控模板制作"><a href="#6-2-1-打印机耗材监控模板制作" class="headerlink" title="6.2.1 打印机耗材监控模板制作"></a>6.2.1 打印机耗材监控模板制作</h3><h3 id="6-2-2-Zabbix-Server添加打印机"><a href="#6-2-2-Zabbix-Server添加打印机" class="headerlink" title="6.2.2 Zabbix Server添加打印机"></a>6.2.2 Zabbix Server添加打印机</h3><h1 id="7-Zabbix监控MySQL服务"><a href="#7-Zabbix监控MySQL服务" class="headerlink" title="7.Zabbix监控MySQL服务"></a>7.Zabbix监控MySQL服务</h1><h2 id="7-1-zabbix官方模板说明"><a href="#7-1-zabbix官方模板说明" class="headerlink" title="7.1 zabbix官方模板说明"></a>7.1 zabbix官方模板说明</h2><figure><div class="code-wrapper"><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#官方mysql模板说明地址</span>
https://www.zabbix.com/cn/integrations/mysql

<span class="token number">1</span>.Install Zabbix agent and MySQL client. If necessary, <span class="token function">add</span> the path to the mysql and mysqladmin utilities to the global environment variable <span class="token environment constant">PATH</span><span class="token builtin class-name">.</span>
<span class="token number">2</span>.Copy template_db_mysql.conf into the folder with Zabbix agent configuration <span class="token punctuation">(</span>/etc/zabbix/zabbix_agentd.d/ by default<span class="token punctuation">)</span>. Don<span class="token string">'t forget to restart Zabbix agent.
3.Create a MySQL user for monitoring (&lt;password> at your discretion):
    CREATE USER '</span>zbx_monitor<span class="token string">'@'</span>%<span class="token string">' IDENTIFIED BY '</span><span class="token operator">&lt;</span>password<span class="token operator">></span><span class="token string">';
    GRANT REPLICATION CLIENT,PROCESS,SHOW DATABASES,SHOW VIEW ON *.* TO '</span>zbx_monitor<span class="token string">'@'</span>%<span class="token string">';
4.Create .my.cnf in the home directory of Zabbix agent for Linux (/var/lib/zabbix by default ) or my.cnf in c:\ for Windows. The file must have three strings:
    [client]
    user='</span>zbx_monitor<span class="token string">'
    password='</span><span class="token operator">&lt;</span>password<span class="token operator">></span>'</code></pre></div></figure>



<h2 id="7-2-zabbix-agent配置"><a href="#7-2-zabbix-agent配置" class="headerlink" title="7.2 zabbix_agent配置"></a>7.2 zabbix_agent配置</h2><p><strong>创建mysql用户授权：</strong></p>
<figure><div class="code-wrapper"><pre class="language-bash" data-language="bash"><code class="language-bash">CREATE <span class="token environment constant">USER</span> <span class="token string">'zbx_monitor'</span>@<span class="token string">'%'</span> IDENTIFIED BY <span class="token string">'Admin@123'</span><span class="token punctuation">;</span>
GRANT REPLICATION CLIENT,PROCESS,SHOW DATABASES,SHOW VIEW ON *.* TO <span class="token string">'zbx_monitor'</span>@<span class="token string">'%'</span><span class="token punctuation">;</span>
flush privileges<span class="token punctuation">;</span></code></pre></div></figure>



<p><strong>在&#x2F;var&#x2F;lib&#x2F;zabbix，新建.my.cnf隐藏文件：</strong></p>
<figure><div class="code-wrapper"><pre class="language-bash" data-language="bash"><code class="language-bash">root@mysql-master:~<span class="token comment"># mkdir /var/lib/zabbix/</span>
root@mysql-master:~<span class="token comment"># vim /var/lib/zabbix/.my.cnf</span>
<span class="token punctuation">[</span>client<span class="token punctuation">]</span>
<span class="token assign-left variable">user</span><span class="token operator">=</span>zbx_monitor
<span class="token assign-left variable">password</span><span class="token operator">=</span><span class="token string">'Admin@123'</span></code></pre></div></figure>



<p><strong>在源码安装包中复制模板文件到zabbix目录：</strong></p>
<figure><div class="code-wrapper"><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#1.复制模板</span>
root@mysql-master:~<span class="token comment"># cp zabbix-6.0.16/conf/zabbix_agentd/userparameter_mysql.conf /etc/zabbix/zabbix_agentd.d/</span>

<span class="token comment">#2.测试是否能正常获取数据</span>
root@mysql-master:~<span class="token comment"># HOME=/var/lib/zabbix/ mysqladmin ping</span>
mysqld is alive

<span class="token comment">#3.配置zabbix agent</span>
root@mysql-master:~<span class="token comment"># grep -Ev "^#|^$" /etc/zabbix/zabbix_agentd.conf </span>
<span class="token assign-left variable">PidFile</span><span class="token operator">=</span>/run/zabbix/zabbix_agentd.pid
<span class="token assign-left variable">LogFile</span><span class="token operator">=</span>/var/log/zabbix/zabbix_agentd.log
<span class="token assign-left variable">LogFileSize</span><span class="token operator">=</span><span class="token number">0</span>
<span class="token assign-left variable">Server</span><span class="token operator">=</span><span class="token number">192.168</span>.1.30
<span class="token assign-left variable">ServerActive</span><span class="token operator">=</span><span class="token number">192.168</span>.1.30
<span class="token assign-left variable">Hostname</span><span class="token operator">=</span><span class="token number">192.168</span>.1.31
<span class="token assign-left variable">Include</span><span class="token operator">=</span>/etc/zabbix/zabbix_agentd.d/*.conf

<span class="token comment">#4.重启zabbix agent</span>
root@mysql-master:~<span class="token comment"># systemctl restart zabbix-agent</span></code></pre></div></figure>



<p><strong>Zabbix Server添加mysql模板：</strong></p>
<p><img src="/2023/04/17/Monitor/Zabbix/zabbix05/image-20230422230130711.png" srcset="/img/loading.gif" lazyload alt="image-20230422230130711"> </p>
<p><img src="/2023/04/17/Monitor/Zabbix/zabbix05/image-20230422230217173.png" srcset="/img/loading.gif" lazyload alt="image-20230422230217173"> </p>
<h1 id="8-Zabbix监控HAProxy服务"><a href="#8-Zabbix监控HAProxy服务" class="headerlink" title="8.Zabbix监控HAProxy服务"></a>8.Zabbix监控HAProxy服务</h1><h1 id="9-Zabbix监控之故障自愈"><a href="#9-Zabbix监控之故障自愈" class="headerlink" title="9.Zabbix监控之故障自愈"></a>9.Zabbix监控之故障自愈</h1><h1 id="10-Zabbix基于Grafana实现图形显示"><a href="#10-Zabbix基于Grafana实现图形显示" class="headerlink" title="10.Zabbix基于Grafana实现图形显示"></a>10.Zabbix基于Grafana实现图形显示</h1><h1 id="11-Zabbix监控Elasticsearch服务"><a href="#11-Zabbix监控Elasticsearch服务" class="headerlink" title="11.Zabbix监控Elasticsearch服务"></a>11.Zabbix监控Elasticsearch服务</h1><h1 id="12-Zabbix监控Ceph服务"><a href="#12-Zabbix监控Ceph服务" class="headerlink" title="12.Zabbix监控Ceph服务"></a>12.Zabbix监控Ceph服务</h1>
                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/Linux/" class="category-chain-item">Linux</a>
  
  
    <span>></span>
    
  <a href="/categories/Linux/Zabbix/" class="category-chain-item">Zabbix</a>
  
  

  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/Zabbix/">#Zabbix</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>(5).Zabbix监控案例</div>
      <div>https://chsblogs.gitee.io/2023/04/17/Monitor/Zabbix/zabbix05/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>陈怀森</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2023年4月17日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2023/04/17/Monitor/Zabbix/zabbix06/" title="(6).Zabbix事件通知机制">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">(6).Zabbix事件通知机制</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2023/04/17/Monitor/Zabbix/zabbix04/" title="(4).Zabbix分布式监控Proxy">
                        <span class="hidden-mobile">(4).Zabbix分布式监控Proxy</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
  
  
    <article id="comments" lazyload>
      
  <div class="disqus" style="width:100%">
    <div id="disqus_thread"></div>
    
      <script type="text/javascript">
        var disqus_config = function() {
          this.page.url = 'https://chsblogs.gitee.io/2023/04/17/Monitor/Zabbix/zabbix05/';
          this.page.identifier = '/2023/04/17/Monitor/Zabbix/zabbix05/';
        };
        Fluid.utils.loadComments('#disqus_thread', function() {
          var d = document, s = d.createElement('script');
          s.src = '//' + 'fluid' + '.disqus.com/embed.js';
          s.setAttribute('data-timestamp', new Date());
          (d.head || d.body).appendChild(s);
        });
      </script>
    
    <noscript>Please enable JavaScript to view the comments</noscript>
  </div>


    </article>
  


          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar category-bar" style="margin-left: -1rem">
    





<div class="category-list">
  
  
    
    
    
    <div class="category row nomargin-x">
      <a class="category-item 
          list-group-item category-item-action col-10 col-md-11 col-xm-11" title="Zabbix"
        id="heading-d1ddc1b1c3c258570ba6994be1aeaddf" role="tab" data-toggle="collapse" href="#collapse-d1ddc1b1c3c258570ba6994be1aeaddf"
        aria-expanded="true"
      >
        Zabbix
        <span class="list-group-count">(6)</span>
        <i class="iconfont icon-arrowright"></i>
      </a>
      
      <div class="category-collapse collapse show" id="collapse-d1ddc1b1c3c258570ba6994be1aeaddf"
           role="tabpanel" aria-labelledby="heading-d1ddc1b1c3c258570ba6994be1aeaddf">
        
        
          
  <div class="category-post-list">
    
    
      
      
        <a href="/2023/04/17/Monitor/Zabbix/zabbix01/" title="(1).Zabbix简介"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">(1).Zabbix简介</span>
        </a>
      
    
      
      
        <a href="/2023/04/17/Monitor/Zabbix/zabbix02/" title="(2).Zabbix安装"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">(2).Zabbix安装</span>
        </a>
      
    
      
      
        <a href="/2023/04/17/Monitor/Zabbix/zabbix03/" title="(3).Zabbix配置文件详解"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">(3).Zabbix配置文件详解</span>
        </a>
      
    
      
      
        <a href="/2023/04/17/Monitor/Zabbix/zabbix04/" title="(4).Zabbix分布式监控Proxy"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">(4).Zabbix分布式监控Proxy</span>
        </a>
      
    
      
      
        <a href="/2023/04/17/Monitor/Zabbix/zabbix05/" title="(5).Zabbix监控案例"
           class="list-group-item list-group-item-action
           active">
          <span class="category-post">(5).Zabbix监控案例</span>
        </a>
      
    
      
      
        <a href="/2023/04/17/Monitor/Zabbix/zabbix06/" title="(6).Zabbix事件通知机制"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">(6).Zabbix事件通知机制</span>
        </a>
      
    
  </div>

        
      </div>
    </div>
  
</div>


  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
  
  
    <!-- 备案信息 ICP for China -->
    <div class="beian">
  <span>
    <a href="http://beian.miit.gov.cn/" target="_blank" rel="nofollow noopener">
      Copyright © 2023 by 陈怀森
    </a>
  </span>
  
    
      <span>
        <a
          href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=20005950"
          rel="nofollow noopener"
          class="beian-police"
          target="_blank"
        >
          
            <span style="visibility: hidden; width: 0">|</span>
            <img src="/img/police_beian.png" srcset="/img/loading.gif" lazyload alt="police-icon"/>
          
          <span>赣ICP备20005950号-1</span>
        </a>
      </span>
    
  
</div>

  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.10/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
